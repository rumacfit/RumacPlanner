<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Planner</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ“…</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-bg: #fafafa;
            --color-surface: #ffffff;
            --color-text: #18181b;
            --color-text-secondary: #71717a;
            --color-border: #e4e4e7;
            --color-border-hover: #d4d4d8;
            
            --color-primary: #0284c7;
            --color-primary-light: #e0f2fe;
            --color-primary-hover: #0369a1;
            
            --color-work: #0891b2;
            --color-work-light: #ecfeff;
            --color-training: #ea580c;
            --color-training-light: #fff7ed;
            --color-task: #8b5cf6;
            --color-task-light: #f5f3ff;
            
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
            
            --transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0 1rem 0;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 1.5rem;
        }

        .tabs {
            display: flex;
            gap: 0.25rem;
        }

        .tab {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .tab:hover {
            background: var(--color-surface);
            color: var(--color-text);
        }

        .tab.active {
            background: var(--color-text);
            color: white;
        }

        .user-toggle {
            display: flex;
            gap: 0.25rem;
            background: var(--color-surface);
            padding: 0.25rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .user-btn {
            padding: 0.375rem 0.875rem;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .user-btn.active {
            background: var(--color-text);
            color: white;
            box-shadow: var(--shadow-xs);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            border-color: var(--color-border-hover);
            box-shadow: var(--shadow-sm);
        }

        /* Week Days Grid */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .day-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .day-card:hover {
            border-color: var(--color-border-hover);
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        .day-card.active {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-light);
        }

        .day-name {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
        }

        .day-date {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .day-indicators {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .indicator {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        .indicator-work {
            background: var(--color-work-light);
            color: var(--color-work);
        }

        .indicator-training {
            background: var(--color-training-light);
            color: var(--color-training);
        }

        .indicator-tasks {
            background: var(--color-task-light);
            color: var(--color-task);
        }

        /* Daily Detail Panels */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .panel {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .panel-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--color-surface);
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .panel-body {
            padding: 1.25rem;
        }

        /* Events Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .event-item {
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid;
            background: var(--color-bg);
        }

        .event-time {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 0.25rem;
        }

        .event-title {
            font-weight: 600;
            margin-bottom: 0.125rem;
        }

        .event-detail {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
        }

        /* Tasks */
        .priority-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--color-border);
        }

        .priority-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
            margin-bottom: 0.75rem;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--color-bg);
            border-radius: 0.5rem;
            transition: var(--transition);
        }

        .task-item:hover {
            background: var(--color-border);
        }

        .task-checkbox {
            width: 1.125rem;
            height: 1.125rem;
            border: 2px solid var(--color-border);
            border-radius: 0.25rem;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 0.125rem;
            transition: var(--transition);
        }

        .task-checkbox:hover {
            border-color: var(--color-primary);
        }

        .task-checkbox.checked {
            background: var(--color-primary);
            border-color: var(--color-primary);
            position: relative;
        }

        .task-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .task-title {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .task-title.completed {
            text-decoration: line-through;
            color: var(--color-text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: var(--color-surface);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .modal-description {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        /* Calendar Event Modal Styles */
        .modal-section {
            margin-bottom: 1.5rem;
        }

        .modal-section-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            cursor: pointer;
        }

        .checkbox-option input[type="checkbox"] {
            width: 1.125rem;
            height: 1.125rem;
            cursor: pointer;
        }

        .user-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .user-option:hover {
            background: var(--color-bg);
        }

        .user-option.selected {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
        }

        .user-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }

        .user-avatar.macca {
            background: #0891b2;
        }

        .user-avatar.ruby {
            background: #ea580c;
        }

        .user-name {
            font-weight: 500;
        }

        .color-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
        }

        .color-option {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--color-text);
            box-shadow: var(--shadow-md);
        }

        .show-in-options {
            display: flex;
            gap: 1.5rem;
        }

        /* Form Groups */
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            font-family: inherit;
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-light);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        /* Client Tracker */
        .client-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .week-column {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            overflow: hidden;
            min-height: 350px;
        }

        .week-header {
            padding: 0.875rem 1rem;
            background: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .week-header.weekly-clients {
            background: var(--color-primary-light);
            color: var(--color-primary);
            border-bottom: 2px solid var(--color-primary);
        }

        .week-body {
            padding: 0.75rem;
        }

        .client-card {
            padding: 0.75rem;
            background: var(--color-work-light);
            border-left: 3px solid var(--color-work);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .client-name {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .client-actions {
            display: flex;
            gap: 0.25rem;
        }

        .icon-btn {
            padding: 0.25rem 0.5rem;
            border: none;
            background: white;
            color: var(--color-text-secondary);
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .icon-btn:hover {
            background: var(--color-text);
            color: white;
        }

        /* Calendar Views */
        .calendar-container {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--color-border);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--color-bg);
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
        }

        .calendar-day {
            background: var(--color-surface);
            padding: 0.75rem;
            min-height: 100px;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: var(--color-bg);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: var(--color-primary-light);
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .calendar-event {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: var(--color-work-light);
            border-left: 2px solid var(--color-work);
            border-radius: 0.25rem;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .year-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        .mini-month {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .mini-month-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .mini-month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .mini-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            border-radius: 0.25rem;
        }

        .mini-day.has-events {
            background: var(--color-work-light);
            color: var(--color-work);
            font-weight: 600;
        }

        .mini-day.today {
            background: var(--color-primary);
            color: white;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .client-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .week-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .week-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .detail-grid {
                grid-template-columns: 1fr;
            }
            .client-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function DailyPlanner() {
            // State
            const [currentUser, setCurrentUser] = useState(() => {
                return localStorage.getItem('currentUser') || 'both';
            });
            const [mode, setMode] = useState('daily');
            
            const getTodayIndex = () => {
                const jsDay = new Date().getDay();
                return jsDay === 0 ? 6 : jsDay - 1;
            };
            
            const [selectedDay, setSelectedDay] = useState(getTodayIndex());
            const [showAddEventModal, setShowAddEventModal] = useState(false);
            const [showAddTaskModal, setShowAddTaskModal] = useState(false);
            const [showImportModal, setShowImportModal] = useState(false);
            const [importText, setImportText] = useState('');
            const [newEvent, setNewEvent] = useState({ 
                startTime: '', 
                endTime: '',
                title: '', 
                detail: '', 
                color: '#0891b2',
                assignedTo: currentUser === 'both' ? ['macca', 'ruby'] : [currentUser]
            });
            const [newTask, setNewTask] = useState({ 
                title: '', 
                priority: false,
                assignedTo: currentUser === 'both' ? ['macca', 'ruby'] : [currentUser]
            });
            const [showAddClientModal, setShowAddClientModal] = useState(false);
            const [newClient, setNewClient] = useState({ name: '', week: 0 });
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            
            // Edit states
            const [editingEvent, setEditingEvent] = useState(null);
            const [editingTask, setEditingTask] = useState(null);
            
            // Calendar event modal
            const [showCalendarEventModal, setShowCalendarEventModal] = useState(false);
            const [newCalendarEvent, setNewCalendarEvent] = useState({
                title: '',
                startDate: new Date().toISOString().split('T')[0],
                endDate: '',
                hasEndDate: false,
                startTime: '',
                hasStartTime: false,
                location: '',
                assignedTo: ['macca', 'ruby'], // Both by default
                showInDaily: true,
                showInMonthly: true,
                description: ''
            });

            // Data structure
            const getDefaultWeekData = () => ({
                0: { events: [], tasks: [] },
                1: { events: [], tasks: [] },
                2: { events: [], tasks: [] },
                3: { events: [], tasks: [] },
                4: { events: [], tasks: [] },
                5: { events: [], tasks: [] },
                6: { events: [], tasks: [] }
            });

            const [weekData, setWeekData] = useState(() => {
                const saved = localStorage.getItem(`planner_${currentUser}`);
                return saved ? JSON.parse(saved) : getDefaultWeekData();
            });

            // Universal client data (shared across users)
            const [clientData, setClientData] = useState(() => {
                const saved = localStorage.getItem('clients_universal');
                return saved ? JSON.parse(saved) : { clients: [] };
            });

            // Universal calendar data for monthly/yearly
            const [calendarData, setCalendarData] = useState(() => {
                const saved = localStorage.getItem('calendar_universal');
                return saved ? JSON.parse(saved) : { events: [] };
            });

            // Auto-calculate client weeks based on start date (for display purposes)
            const getClientCurrentWeek = (startDate) => {
                if (!startDate) return 0;
                const start = new Date(startDate);
                const now = new Date();
                const daysDiff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
                
                // If start date is in the future, return 0 (Starting Next Week)
                if (daysDiff < 0) return 0;
                
                const weekNum = Math.floor(daysDiff / 7) + 1;
                return Math.min(weekNum, 4); // Cap at week 4
            };

            const getClientDayNumber = (startDate) => {
                if (!startDate) return 0;
                const start = new Date(startDate);
                const now = new Date();
                const daysDiff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
                return Math.max(daysDiff + 1, 0); // Day 0, 1, 2, etc.
            };

            // Save data
            useEffect(() => {
                if (currentUser !== 'both') {
                    localStorage.setItem(`planner_${currentUser}`, JSON.stringify(weekData));
                }
            }, [weekData, currentUser]);

            useEffect(() => {
                localStorage.setItem('clients_universal', JSON.stringify(clientData));
            }, [clientData]);

            useEffect(() => {
                localStorage.setItem('calendar_universal', JSON.stringify(calendarData));
            }, [calendarData]);

            // Load data on user change
            useEffect(() => {
                if (currentUser === 'both') {
                    // Load combined data from both users
                    const maccaData = localStorage.getItem('planner_macca');
                    const rubyData = localStorage.getItem('planner_ruby');
                    
                    const macca = maccaData ? JSON.parse(maccaData) : getDefaultWeekData();
                    const ruby = rubyData ? JSON.parse(rubyData) : getDefaultWeekData();
                    
                    // Merge the data
                    const combined = {};
                    Object.keys(macca).forEach(day => {
                        combined[day] = {
                            events: [...(macca[day]?.events || []), ...(ruby[day]?.events || [])],
                            tasks: [...(macca[day]?.tasks || []), ...(ruby[day]?.tasks || [])]
                        };
                    });
                    
                    setWeekData(combined);
                } else {
                    const saved = localStorage.getItem(`planner_${currentUser}`);
                    setWeekData(saved ? JSON.parse(saved) : getDefaultWeekData());
                }
            }, [currentUser]);

            // Helper functions
            const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const today = new Date();

            const getDateForDay = (displayIndex) => {
                const date = new Date(today);
                const currentDayIndex = getTodayIndex();
                const diff = displayIndex - currentDayIndex;
                date.setDate(today.getDate() + diff);
                return date.getDate();
            };

            const getDataIndex = (displayIndex) => {
                return displayIndex === 6 ? 0 : displayIndex + 1;
            };

            const dataIndex = getDataIndex(selectedDay);
            
            // Filter events and tasks based on current user
            const currentDayData = weekData[dataIndex] || { events: [], tasks: [] };
            const filteredEvents = currentUser === 'both' 
                ? currentDayData.events 
                : currentDayData.events.filter(e => e.assignedTo?.includes(currentUser));
            const filteredTasks = currentUser === 'both'
                ? currentDayData.tasks
                : currentDayData.tasks.filter(t => t.assignedTo?.includes(currentUser));
            
            const priorityTasks = filteredTasks.filter(t => t.priority && !t.completed);
            const regularTasks = filteredTasks.filter(t => !t.priority && !t.completed);
            const completedTasks = filteredTasks.filter(t => t.completed);
            
            // Color options for events
            const colorOptions = [
                { color: '#0891b2', name: 'Cyan' },
                { color: '#ea580c', name: 'Orange' },
                { color: '#8b5cf6', name: 'Purple' },
                { color: '#22c55e', name: 'Green' },
                { color: '#ef4444', name: 'Red' },
                { color: '#f59e0b', name: 'Amber' },
                { color: '#ec4899', name: 'Pink' },
                { color: '#06b6d4', name: 'Sky' },
                { color: '#84cc16', name: 'Lime' },
                { color: '#6366f1', name: 'Indigo' },
                { color: '#a855f7', name: 'Violet' },
                { color: '#14b8a6', name: 'Teal' }
            ];
            
            const openEditEvent = (event) => {
                setEditingEvent(event);
                setNewEvent({
                    startTime: event.startTime,
                    endTime: event.endTime || '',
                    title: event.title,
                    detail: event.detail || '',
                    color: event.color || '#0891b2',
                    assignedTo: event.assignedTo || [currentUser]
                });
                setShowAddEventModal(true);
            };
            
            const openEditTask = (task) => {
                setEditingTask(task);
                setNewTask({
                    title: task.title,
                    priority: task.priority,
                    assignedTo: task.assignedTo || [currentUser]
                });
                setShowAddTaskModal(true);
            };
            
            const toggleEventUserAssignment = (userId) => {
                setNewEvent(prev => {
                    const assigned = prev.assignedTo.includes(userId);
                    return {
                        ...prev,
                        assignedTo: assigned 
                            ? prev.assignedTo.filter(id => id !== userId)
                            : [...prev.assignedTo, userId]
                    };
                });
            };
            
            const toggleTaskUserAssignment = (userId) => {
                setNewTask(prev => {
                    const assigned = prev.assignedTo.includes(userId);
                    return {
                        ...prev,
                        assignedTo: assigned 
                            ? prev.assignedTo.filter(id => id !== userId)
                            : [...prev.assignedTo, userId]
                    };
                });
            };

            // Event handlers
            const handleAddEvent = () => {
                if (!newEvent.startTime || !newEvent.title) return;
                if (currentUser === 'both') return; // Can't add in combined view
                
                const dataIndex = getDataIndex(selectedDay);
                
                if (editingEvent) {
                    // Update existing event
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            events: prev[dataIndex].events.map(e =>
                                e.id === editingEvent.id ? { ...newEvent, id: e.id } : e
                            )
                        }
                    }));
                    setEditingEvent(null);
                } else {
                    // Add new event
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            events: [...(prev[dataIndex].events || []), {
                                id: Date.now(),
                                ...newEvent
                            }]
                        }
                    }));
                }
                
                setNewEvent({ 
                    startTime: '', 
                    endTime: '',
                    title: '', 
                    detail: '', 
                    color: '#0891b2',
                    assignedTo: currentUser === 'both' ? ['macca', 'ruby'] : [currentUser]
                });
                setShowAddEventModal(false);
            };

            const handleDeleteEvent = (eventId) => {
                if (currentUser === 'both') return;
                const dataIndex = getDataIndex(selectedDay);
                
                if (confirm('Delete this event?')) {
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            events: prev[dataIndex].events.filter(e => e.id !== eventId)
                        }
                    }));
                    setShowAddEventModal(false);
                    setEditingEvent(null);
                }
            };

            const handleAddTask = () => {
                if (!newTask.title) return;
                if (currentUser === 'both') return; // Can't add in combined view
                
                const dataIndex = getDataIndex(selectedDay);
                
                if (editingTask) {
                    // Update existing task
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            tasks: prev[dataIndex].tasks.map(t =>
                                t.id === editingTask.id ? { ...newTask, id: t.id, completed: t.completed } : t
                            )
                        }
                    }));
                    setEditingTask(null);
                } else {
                    // Add new task
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            tasks: [...(prev[dataIndex].tasks || []), {
                                id: Date.now(),
                                title: newTask.title,
                                completed: false,
                                priority: newTask.priority,
                                assignedTo: newTask.assignedTo
                            }]
                        }
                    }));
                }
                
                setNewTask({ 
                    title: '', 
                    priority: false,
                    assignedTo: currentUser === 'both' ? ['macca', 'ruby'] : [currentUser]
                });
                setShowAddTaskModal(false);
            };

            const handleDeleteTask = (taskId) => {
                if (currentUser === 'both') return;
                const dataIndex = getDataIndex(selectedDay);
                
                if (confirm('Delete this task?')) {
                    setWeekData(prev => ({
                        ...prev,
                        [dataIndex]: {
                            ...prev[dataIndex],
                            tasks: prev[dataIndex].tasks.filter(t => t.id !== taskId)
                        }
                    }));
                    setShowAddTaskModal(false);
                    setEditingTask(null);
                }
            };

            const toggleTaskComplete = (taskId) => {
                if (currentUser === 'both') return; // Can't edit in combined view
                
                setWeekData(prev => ({
                    ...prev,
                    [dataIndex]: {
                        ...prev[dataIndex],
                        tasks: prev[dataIndex].tasks.map(task =>
                            task.id === taskId ? { ...task, completed: !task.completed } : task
                        )
                    }
                }));
            };

            const handleTextImport = () => {
                if (!importText.trim()) return;

                const lines = importText.trim().split('\n');
                const newData = { ...weekData };

                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (!trimmed) return;

                    const dayMatch = trimmed.match(/^(mon|tue|wed|thu|fri|sat|sun)/i);
                    if (!dayMatch) return;

                    const dayName = dayMatch[1].toLowerCase();
                    const dayIndex = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'].indexOf(dayName.substring(0, 3));
                    if (dayIndex === -1) return;

                    const dataIdx = dayIndex === 6 ? 0 : dayIndex + 1;

                    const timeMatch = trimmed.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
                    if (!timeMatch) return;

                    let hour = parseInt(timeMatch[1]);
                    const minute = timeMatch[2] || '00';
                    const meridian = timeMatch[3];

                    if (meridian) {
                        if (meridian.toLowerCase() === 'pm' && hour < 12) hour += 12;
                        if (meridian.toLowerCase() === 'am' && hour === 12) hour = 0;
                    }

                    const time = `${hour.toString().padStart(2, '0')}:${minute}`;
                    const rest = trimmed.substring(dayMatch[0].length + (timeMatch[0].length || 0)).trim();
                    const title = rest || 'Event';

                    const lowerRest = rest.toLowerCase();
                    const type = lowerRest.includes('shift') || lowerRest.includes('work') || lowerRest.includes('conditn') 
                        ? 'work' : 'training';

                    if (!newData[dataIdx].events) {
                        newData[dataIdx].events = [];
                    }

                    newData[dataIdx].events.push({
                        id: Date.now() + Math.random(),
                        type: type,
                        time: time,
                        title: title,
                        detail: ''
                    });
                });

                setWeekData(newData);
                setImportText('');
                setShowImportModal(false);
            };

            const handleAddCalendarEvent = () => {
                if (!newCalendarEvent.title || !newCalendarEvent.startDate) return;

                const event = {
                    id: Date.now(),
                    ...newCalendarEvent,
                    createdAt: new Date().toISOString()
                };

                setCalendarData(prev => ({
                    events: [...prev.events, event]
                }));

                // Reset form
                setNewCalendarEvent({
                    title: '',
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: '',
                    hasEndDate: false,
                    startTime: '',
                    hasStartTime: false,
                    location: '',
                    assignedTo: ['macca', 'ruby'],
                    showInDaily: true,
                    showInMonthly: true,
                    description: ''
                });
                setShowCalendarEventModal(false);
            };

            const openCalendarEventModal = (date) => {
                setNewCalendarEvent(prev => ({
                    ...prev,
                    startDate: date
                }));
                setShowCalendarEventModal(true);
            };

            const toggleUserAssignment = (userId) => {
                setNewCalendarEvent(prev => {
                    const assigned = prev.assignedTo.includes(userId);
                    return {
                        ...prev,
                        assignedTo: assigned 
                            ? prev.assignedTo.filter(id => id !== userId)
                            : [...prev.assignedTo, userId]
                    };
                });
            };

            return (
                <div className="app-container">
                    {/* Header */}
                    <div className="header">
                        <div className="tabs">
                            <button className={`tab ${mode === 'daily' ? 'active' : ''}`} onClick={() => setMode('daily')}>
                                Daily
                            </button>
                            <button className={`tab ${mode === 'monthly' ? 'active' : ''}`} onClick={() => setMode('monthly')}>
                                Monthly
                            </button>
                            <button className={`tab ${mode === 'yearly' ? 'active' : ''}`} onClick={() => setMode('yearly')}>
                                Yearly
                            </button>
                            <button className={`tab ${mode === 'clients' ? 'active' : ''}`} onClick={() => setMode('clients')}>
                                Clients
                            </button>
                        </div>
                        
                        <div className="user-toggle">
                            <button 
                                className={`user-btn ${currentUser === 'macca' ? 'active' : ''}`}
                                onClick={() => {
                                    setCurrentUser('macca');
                                    localStorage.setItem('currentUser', 'macca');
                                }}
                            >
                                Macca
                            </button>
                            <button 
                                className={`user-btn ${currentUser === 'ruby' ? 'active' : ''}`}
                                onClick={() => {
                                    setCurrentUser('ruby');
                                    localStorage.setItem('currentUser', 'ruby');
                                }}
                            >
                                Ruby
                            </button>
                            <button 
                                className={`user-btn ${currentUser === 'both' ? 'active' : ''}`}
                                onClick={() => {
                                    setCurrentUser('both');
                                    localStorage.setItem('currentUser', 'both');
                                }}
                            >
                                Both
                            </button>
                        </div>
                    </div>

                    {/* Daily View */}
                    {mode === 'daily' && (
                        <>
                            <div className="section-header">
                                <h2 className="section-title">Week Overview</h2>
                                <button className="btn btn-secondary" onClick={() => setShowImportModal(true)}>
                                    Import Schedule
                                </button>
                            </div>

                            <div className="week-grid">
                                {dayNames.map((day, displayIndex) => {
                                    const dataIdx = getDataIndex(displayIndex);
                                    const dayData = weekData[dataIdx] || { events: [], tasks: [] };
                                    const workEvents = dayData.events.filter(e => e.type === 'work');
                                    const trainingEvents = dayData.events.filter(e => e.type === 'training');
                                    const incompleteTasks = dayData.tasks.filter(t => !t.completed).length;

                                    return (
                                        <div 
                                            key={displayIndex}
                                            className={`day-card ${selectedDay === displayIndex ? 'active' : ''}`}
                                            onClick={() => setSelectedDay(displayIndex)}
                                        >
                                            <div className="day-name">{day}</div>
                                            <div className="day-date">{getDateForDay(displayIndex)}</div>
                                            <div className="day-indicators">
                                                {workEvents.length > 0 && (
                                                    <div className="indicator indicator-work">
                                                        {workEvents.length} shift{workEvents.length > 1 ? 's' : ''}
                                                    </div>
                                                )}
                                                {trainingEvents.length > 0 && (
                                                    <div className="indicator indicator-training">
                                                        {trainingEvents.length} workout{trainingEvents.length > 1 ? 's' : ''}
                                                    </div>
                                                )}
                                                {incompleteTasks > 0 && (
                                                    <div className="indicator indicator-tasks">
                                                        {incompleteTasks} task{incompleteTasks > 1 ? 's' : ''}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="detail-grid">
                                {/* Events Panel */}
                                <div className="panel">
                                    <div className="panel-header">
                                        <h3 className="panel-title">{dayNames[selectedDay]}'s Schedule</h3>
                                        {currentUser !== 'both' && (
                                            <button className="btn btn-secondary" onClick={() => setShowAddEventModal(true)}>
                                                + Event
                                            </button>
                                        )}
                                    </div>
                                    <div className="panel-body">
                                        {filteredEvents.length > 0 ? (
                                            <div className="timeline">
                                                {filteredEvents.sort((a, b) => (a.startTime || '').localeCompare(b.startTime || '')).map(event => (
                                                    <div 
                                                        key={event.id} 
                                                        className="event-item"
                                                        style={{
                                                            borderColor: event.color || '#0891b2',
                                                            background: `${event.color || '#0891b2'}15`,
                                                            cursor: currentUser !== 'both' ? 'pointer' : 'default'
                                                        }}
                                                        onClick={() => currentUser !== 'both' && openEditEvent(event)}
                                                    >
                                                        <div className="event-time">
                                                            {event.startTime}
                                                            {event.endTime && ` - ${event.endTime}`}
                                                        </div>
                                                        <div className="event-title">{event.title}</div>
                                                        {event.detail && <div className="event-detail">{event.detail}</div>}
                                                        {event.assignedTo && event.assignedTo.length > 0 && (
                                                            <div style={{
                                                                fontSize: '0.75rem',
                                                                color: 'var(--color-text-secondary)',
                                                                marginTop: '0.25rem'
                                                            }}>
                                                                {event.assignedTo.map(u => u.charAt(0).toUpperCase() + u.slice(1)).join(', ')}
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="empty-state">No events scheduled</div>
                                        )}
                                    </div>
                                </div>

                                {/* Tasks Panel */}
                                <div className="panel">
                                    <div className="panel-header">
                                        <h3 className="panel-title">Tasks</h3>
                                        {currentUser !== 'both' && (
                                            <button className="btn btn-secondary" onClick={() => setShowAddTaskModal(true)}>
                                                + Task
                                            </button>
                                        )}
                                    </div>
                                    <div className="panel-body">
                                        {priorityTasks.length > 0 && (
                                            <div className="priority-section">
                                                <div className="priority-label">Priority Tasks</div>
                                                <div className="task-list">
                                                    {priorityTasks.map(task => (
                                                        <div 
                                                            key={task.id} 
                                                            className="task-item"
                                                            style={{cursor: currentUser !== 'both' ? 'pointer' : 'default'}}
                                                            onClick={(e) => {
                                                                if (currentUser !== 'both' && !e.target.classList.contains('task-checkbox')) {
                                                                    openEditTask(task);
                                                                }
                                                            }}
                                                        >
                                                            <div 
                                                                className={`task-checkbox ${task.completed ? 'checked' : ''}`}
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    toggleTaskComplete(task.id);
                                                                }}
                                                            />
                                                            <div style={{flex: 1}}>
                                                                <div className={`task-title ${task.completed ? 'completed' : ''}`}>
                                                                    {task.title}
                                                                </div>
                                                                {task.assignedTo && task.assignedTo.length > 0 && (
                                                                    <div style={{
                                                                        fontSize: '0.75rem',
                                                                        color: 'var(--color-text-secondary)',
                                                                        marginTop: '0.125rem'
                                                                    }}>
                                                                        {task.assignedTo.map(u => u.charAt(0).toUpperCase() + u.slice(1)).join(', ')}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {regularTasks.length > 0 && (
                                            <div className="task-list">
                                                {regularTasks.map(task => (
                                                    <div 
                                                        key={task.id} 
                                                        className="task-item"
                                                        style={{cursor: currentUser !== 'both' ? 'pointer' : 'default'}}
                                                        onClick={(e) => {
                                                            if (currentUser !== 'both' && !e.target.classList.contains('task-checkbox')) {
                                                                openEditTask(task);
                                                            }
                                                        }}
                                                    >
                                                        <div 
                                                            className={`task-checkbox ${task.completed ? 'checked' : ''}`}
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                toggleTaskComplete(task.id);
                                                            }}
                                                        />
                                                        <div style={{flex: 1}}>
                                                            <div className={`task-title ${task.completed ? 'completed' : ''}`}>
                                                                {task.title}
                                                            </div>
                                                            {task.assignedTo && task.assignedTo.length > 0 && (
                                                                <div style={{
                                                                    fontSize: '0.75rem',
                                                                    color: 'var(--color-text-secondary)',
                                                                    marginTop: '0.125rem'
                                                                }}>
                                                                    {task.assignedTo.map(u => u.charAt(0).toUpperCase() + u.slice(1)).join(', ')}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {priorityTasks.length === 0 && regularTasks.length === 0 && (
                                            <div className="empty-state">No tasks for today</div>
                                        )}

                                        {completedTasks.length > 0 && (
                                            <div style={{marginTop: '1.5rem', paddingTop: '1.5rem', borderTop: '1px solid var(--color-border)'}}>
                                                <div className="priority-label" style={{marginBottom: '0.75rem'}}>
                                                    Completed ({completedTasks.length})
                                                </div>
                                                <div className="task-list">
                                                    {completedTasks.map(task => (
                                                        <div 
                                                            key={task.id} 
                                                            className="task-item"
                                                            style={{cursor: currentUser !== 'both' ? 'pointer' : 'default'}}
                                                            onClick={(e) => {
                                                                if (currentUser !== 'both' && !e.target.classList.contains('task-checkbox')) {
                                                                    openEditTask(task);
                                                                }
                                                            }}
                                                        >
                                                            <div 
                                                                className="task-checkbox checked"
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    toggleTaskComplete(task.id);
                                                                }}
                                                            />
                                                            <div style={{flex: 1}}>
                                                                <div className="task-title completed">{task.title}</div>
                                                                {task.assignedTo && task.assignedTo.length > 0 && (
                                                                    <div style={{
                                                                        fontSize: '0.75rem',
                                                                        color: 'var(--color-text-secondary)',
                                                                        marginTop: '0.125rem'
                                                                    }}>
                                                                        {task.assignedTo.map(u => u.charAt(0).toUpperCase() + u.slice(1)).join(', ')}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </>
                    )}

                    {/* Monthly View */}
                    {mode === 'monthly' && (
                        <div className="calendar-container">
                            <div className="calendar-header">
                                <h2 className="calendar-title">
                                    {currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                                </h2>
                                <div style={{display: 'flex', gap: '0.75rem', alignItems: 'center'}}>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => openCalendarEventModal(new Date().toISOString().split('T')[0])}
                                    >
                                        + Add Event
                                    </button>
                                    <div className="calendar-nav">
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                const newMonth = new Date(currentMonth);
                                                newMonth.setMonth(newMonth.getMonth() - 1);
                                                setCurrentMonth(newMonth);
                                            }}
                                        >
                                            â†
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => setCurrentMonth(new Date())}
                                        >
                                            Today
                                        </button>
                                        <button 
                                            className="btn btn-secondary"
                                            onClick={() => {
                                                const newMonth = new Date(currentMonth);
                                                newMonth.setMonth(newMonth.getMonth() + 1);
                                                setCurrentMonth(newMonth);
                                            }}
                                        >
                                            â†’
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="month-grid">
                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                    <div key={day} className="calendar-day-header">{day}</div>
                                ))}
                                
                                {(() => {
                                    const year = currentMonth.getFullYear();
                                    const month = currentMonth.getMonth();
                                    const firstDay = new Date(year, month, 1).getDay();
                                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                                    const daysInPrevMonth = new Date(year, month, 0).getDate();
                                    
                                    const days = [];
                                    const today = new Date();
                                    
                                    // Previous month days
                                    for (let i = firstDay - 1; i >= 0; i--) {
                                        days.push(
                                            <div key={`prev-${i}`} className="calendar-day other-month">
                                                <div className="calendar-day-number">{daysInPrevMonth - i}</div>
                                            </div>
                                        );
                                    }
                                    
                                    // Current month days
                                    for (let day = 1; day <= daysInMonth; day++) {
                                        const isToday = today.getDate() === day && 
                                                       today.getMonth() === month && 
                                                       today.getFullYear() === year;
                                        
                                        const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                                        
                                        // Filter events for this day
                                        const dayEvents = calendarData.events.filter(event => {
                                            if (!event.showInMonthly) return false;
                                            
                                            const eventStart = event.startDate;
                                            const eventEnd = event.hasEndDate ? event.endDate : event.startDate;
                                            
                                            return dateStr >= eventStart && dateStr <= eventEnd;
                                        });
                                        
                                        days.push(
                                            <div 
                                                key={`current-${day}`} 
                                                className={`calendar-day ${isToday ? 'today' : ''}`}
                                                onClick={() => openCalendarEventModal(dateStr)}
                                            >
                                                <div className="calendar-day-number">{day}</div>
                                                {dayEvents.slice(0, 3).map(event => (
                                                    <div key={event.id} className="calendar-event">
                                                        {event.hasStartTime && event.startTime ? `${event.startTime} ` : ''}{event.title}
                                                    </div>
                                                ))}
                                                {dayEvents.length > 3 && (
                                                    <div style={{fontSize: '0.75rem', color: 'var(--color-text-secondary)', marginTop: '0.25rem'}}>
                                                        +{dayEvents.length - 3} more
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    }
                                    
                                    // Next month days
                                    const remainingDays = 42 - days.length;
                                    for (let i = 1; i <= remainingDays; i++) {
                                        days.push(
                                            <div key={`next-${i}`} className="calendar-day other-month">
                                                <div className="calendar-day-number">{i}</div>
                                            </div>
                                        );
                                    }
                                    
                                    return days;
                                })()}
                            </div>
                        </div>
                    )}

                    {/* Yearly View */}
                    {mode === 'yearly' && (
                        <>
                            <div className="section-header">
                                <h2 className="section-title">{currentYear}</h2>
                                <div style={{display: 'flex', gap: '0.75rem'}}>
                                    <button 
                                        className="btn btn-primary"
                                        onClick={() => openCalendarEventModal(new Date().toISOString().split('T')[0])}
                                    >
                                        + Add Event
                                    </button>
                                    <button 
                                        className="btn btn-secondary"
                                        onClick={() => setCurrentYear(currentYear - 1)}
                                    >
                                        â† {currentYear - 1}
                                    </button>
                                    <button 
                                        className="btn btn-secondary"
                                        onClick={() => setCurrentYear(new Date().getFullYear())}
                                    >
                                        Today
                                    </button>
                                    <button 
                                        className="btn btn-secondary"
                                        onClick={() => setCurrentYear(currentYear + 1)}
                                    >
                                        {currentYear + 1} â†’
                                    </button>
                                </div>
                            </div>

                            <div className="year-grid">
                                {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map(monthIndex => {
                                    const monthDate = new Date(currentYear, monthIndex, 1);
                                    const monthName = monthDate.toLocaleDateString('en-US', { month: 'long' });
                                    const firstDay = monthDate.getDay();
                                    const daysInMonth = new Date(currentYear, monthIndex + 1, 0).getDate();
                                    
                                    const today = new Date();
                                    const isCurrentMonth = today.getMonth() === monthIndex && today.getFullYear() === currentYear;
                                    
                                    return (
                                        <div key={monthIndex} className="mini-month">
                                            <div className="mini-month-title">{monthName}</div>
                                            <div className="mini-month-grid">
                                                {/* Day headers */}
                                                {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                                                    <div key={`header-${i}`} style={{
                                                        fontSize: '0.625rem',
                                                        color: 'var(--color-text-secondary)',
                                                        textAlign: 'center',
                                                        fontWeight: '600'
                                                    }}>
                                                        {d}
                                                    </div>
                                                ))}
                                                
                                                {/* Empty cells for alignment */}
                                                {Array.from({length: firstDay}, (_, i) => (
                                                    <div key={`empty-${i}`}></div>
                                                ))}
                                                
                                                {/* Days */}
                                                {Array.from({length: daysInMonth}, (_, i) => {
                                                    const day = i + 1;
                                                    const isToday = isCurrentMonth && today.getDate() === day;
                                                    
                                                    // Check if day has events
                                                    const dateStr = `${currentYear}-${(monthIndex + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                                                    const hasEvents = calendarData.events.some(event => {
                                                        if (!event.showInMonthly) return false;
                                                        const eventStart = event.startDate;
                                                        const eventEnd = event.hasEndDate ? event.endDate : event.startDate;
                                                        return dateStr >= eventStart && dateStr <= eventEnd;
                                                    });
                                                    
                                                    return (
                                                        <div 
                                                            key={day} 
                                                            className={`mini-day ${isToday ? 'today' : ''} ${hasEvents ? 'has-events' : ''}`}
                                                            onClick={() => {
                                                                setMode('monthly');
                                                                setCurrentMonth(new Date(currentYear, monthIndex, day));
                                                            }}
                                                            style={{cursor: 'pointer'}}
                                                        >
                                                            {day}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </>
                    )}

                    {/* Client Tracker */}
                    {mode === 'clients' && (
                        <>
                            <div className="section-header">
                                <h2 className="section-title">Client Tracker - 4 Week Test ($29)</h2>
                                <button className="btn btn-primary" onClick={() => setShowAddClientModal(true)}>
                                    + Add Client
                                </button>
                            </div>

                            <div className="client-grid">
                                {[0, 1, 2, 3, 4, 5].map(week => {
                                    const weekClients = clientData.clients
                                        .filter(c => c.status === 'active' && c.week === week);
                                    
                                    const weekLabels = {
                                        0: 'Starting Next Week',
                                        1: 'Week 1',
                                        2: 'Week 2',
                                        3: 'Week 3',
                                        4: 'Week 4',
                                        5: 'Weekly Clients'
                                    };
                                    
                                    return (
                                        <div key={week} className="week-column">
                                            <div className={`week-header ${week === 5 ? 'weekly-clients' : ''}`}>
                                                {weekLabels[week]}
                                            </div>
                                            <div className="week-body">
                                                {weekClients.length > 0 ? (
                                                    weekClients.map(client => (
                                                        <div key={client.id} className="client-card">
                                                            <div style={{flex: 1}}>
                                                                <div className="client-name">{client.name}</div>
                                                                {week >= 1 && week <= 4 && client.startDate && (
                                                                    <div style={{
                                                                        fontSize: '0.75rem',
                                                                        color: 'var(--color-text-secondary)',
                                                                        marginTop: '0.25rem'
                                                                    }}>
                                                                        Day {getClientDayNumber(client.startDate)} of 28
                                                                    </div>
                                                                )}
                                                                {week === 0 && client.startDate && (
                                                                    <div style={{
                                                                        fontSize: '0.75rem',
                                                                        color: 'var(--color-text-secondary)',
                                                                        marginTop: '0.25rem'
                                                                    }}>
                                                                        Starts {new Date(client.startDate).toLocaleDateString()}
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="client-actions">
                                                                {/* Backward arrow */}
                                                                {week > 0 && (
                                                                    <button 
                                                                        className="icon-btn"
                                                                        onClick={() => {
                                                                            setClientData(prev => ({
                                                                                ...prev,
                                                                                clients: prev.clients.map(c => 
                                                                                    c.id === client.id ? {...c, week: Math.max(c.week - 1, 0)} : c
                                                                                )
                                                                            }));
                                                                        }}
                                                                        title="Move back one week"
                                                                    >
                                                                        â†
                                                                    </button>
                                                                )}
                                                                {/* Forward arrow */}
                                                                {week < 5 && (
                                                                    <button 
                                                                        className="icon-btn"
                                                                        onClick={() => {
                                                                            setClientData(prev => ({
                                                                                ...prev,
                                                                                clients: prev.clients.map(c => 
                                                                                    c.id === client.id ? {...c, week: Math.min(c.week + 1, 5)} : c
                                                                                )
                                                                            }));
                                                                        }}
                                                                        title={week === 4 ? "Convert to Weekly Client" : "Move forward one week"}
                                                                    >
                                                                        â†’
                                                                    </button>
                                                                )}
                                                                {/* Remove button */}
                                                                <button 
                                                                    className="icon-btn"
                                                                    onClick={() => {
                                                                        if (confirm(`Remove ${client.name}?`)) {
                                                                            setClientData(prev => ({
                                                                                ...prev,
                                                                                clients: prev.clients.filter(c => c.id !== client.id)
                                                                            }));
                                                                        }
                                                                    }}
                                                                    title="Remove client"
                                                                >
                                                                    Ã—
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div className="empty-state">No clients</div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </>
                    )}

                    {/* Add Event Modal */}
                    {showAddEventModal && (
                        <div className="modal-overlay" onClick={() => {
                            setShowAddEventModal(false);
                            setEditingEvent(null);
                        }}>
                            <div className="modal" onClick={e => e.stopPropagation()} style={{maxWidth: '600px'}}>
                                <div className="modal-header">
                                    <h3 className="modal-title">{editingEvent ? 'Edit Event' : 'Add Event'}</h3>
                                </div>
                                <div className="modal-body">
                                    {/* Event Title */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Event Title</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Event title"
                                            value={newEvent.title}
                                            onChange={(e) => setNewEvent({...newEvent, title: e.target.value})}
                                        />
                                    </div>

                                    {/* Time Range */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Time</label>
                                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem'}}>
                                            <div>
                                                <label style={{fontSize: '0.75rem', color: 'var(--color-text-secondary)', marginBottom: '0.25rem', display: 'block'}}>Start Time</label>
                                                <input
                                                    type="time"
                                                    className="form-input"
                                                    value={newEvent.startTime}
                                                    onChange={(e) => setNewEvent({...newEvent, startTime: e.target.value})}
                                                />
                                            </div>
                                            <div>
                                                <label style={{fontSize: '0.75rem', color: 'var(--color-text-secondary)', marginBottom: '0.25rem', display: 'block'}}>End Time (optional)</label>
                                                <input
                                                    type="time"
                                                    className="form-input"
                                                    value={newEvent.endTime}
                                                    onChange={(e) => setNewEvent({...newEvent, endTime: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    {/* Color Picker */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Color</label>
                                        <div className="color-picker">
                                            {colorOptions.map(opt => (
                                                <div
                                                    key={opt.color}
                                                    className={`color-option ${newEvent.color === opt.color ? 'selected' : ''}`}
                                                    style={{backgroundColor: opt.color}}
                                                    onClick={() => setNewEvent({...newEvent, color: opt.color})}
                                                    title={opt.name}
                                                />
                                            ))}
                                        </div>
                                    </div>

                                    {/* Details */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Details (optional)</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Additional details"
                                            value={newEvent.detail}
                                            onChange={(e) => setNewEvent({...newEvent, detail: e.target.value})}
                                        />
                                    </div>

                                    {/* Assign To */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Assign To</label>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                                            <div 
                                                className={`user-option ${newEvent.assignedTo.includes('macca') ? 'selected' : ''}`}
                                                onClick={() => toggleEventUserAssignment('macca')}
                                            >
                                                <div className="user-avatar macca">M</div>
                                                <span className="user-name">Macca</span>
                                            </div>
                                            <div 
                                                className={`user-option ${newEvent.assignedTo.includes('ruby') ? 'selected' : ''}`}
                                                onClick={() => toggleEventUserAssignment('ruby')}
                                            >
                                                <div className="user-avatar ruby">R</div>
                                                <span className="user-name">Ruby</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    {editingEvent && (
                                        <button 
                                            className="btn btn-secondary" 
                                            style={{marginRight: 'auto', background: '#ef4444', color: 'white'}}
                                            onClick={() => handleDeleteEvent(editingEvent.id)}
                                        >
                                            Delete
                                        </button>
                                    )}
                                    <button className="btn btn-secondary" onClick={() => {
                                        setShowAddEventModal(false);
                                        setEditingEvent(null);
                                    }}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={handleAddEvent}>
                                        {editingEvent ? 'Save Changes' : 'Add Event'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Task Modal */}
                    {showAddTaskModal && (
                        <div className="modal-overlay" onClick={() => {
                            setShowAddTaskModal(false);
                            setEditingTask(null);
                        }}>
                            <div className="modal" onClick={e => e.stopPropagation()} style={{maxWidth: '600px'}}>
                                <div className="modal-header">
                                    <h3 className="modal-title">{editingTask ? 'Edit Task' : 'Add Task'}</h3>
                                </div>
                                <div className="modal-body">
                                    {/* Task Description */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Task Description</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Task description"
                                            value={newTask.title}
                                            onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                        />
                                    </div>

                                    {/* Priority Checkbox */}
                                    <div className="modal-section">
                                        <label className="checkbox-option">
                                            <input
                                                type="checkbox"
                                                checked={newTask.priority}
                                                onChange={(e) => setNewTask({...newTask, priority: e.target.checked})}
                                            />
                                            <span>Mark as priority</span>
                                        </label>
                                    </div>

                                    {/* Assign To */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Assign To</label>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                                            <div 
                                                className={`user-option ${newTask.assignedTo.includes('macca') ? 'selected' : ''}`}
                                                onClick={() => toggleTaskUserAssignment('macca')}
                                            >
                                                <div className="user-avatar macca">M</div>
                                                <span className="user-name">Macca</span>
                                            </div>
                                            <div 
                                                className={`user-option ${newTask.assignedTo.includes('ruby') ? 'selected' : ''}`}
                                                onClick={() => toggleTaskUserAssignment('ruby')}
                                            >
                                                <div className="user-avatar ruby">R</div>
                                                <span className="user-name">Ruby</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    {editingTask && (
                                        <button 
                                            className="btn btn-secondary" 
                                            style={{marginRight: 'auto', background: '#ef4444', color: 'white'}}
                                            onClick={() => handleDeleteTask(editingTask.id)}
                                        >
                                            Delete
                                        </button>
                                    )}
                                    <button className="btn btn-secondary" onClick={() => {
                                        setShowAddTaskModal(false);
                                        setEditingTask(null);
                                    }}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={handleAddTask}>
                                        {editingTask ? 'Save Changes' : 'Add Task'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Import Modal */}
                    {showImportModal && (
                        <div className="modal-overlay" onClick={() => setShowImportModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Import Schedule</h3>
                                    <p className="modal-description">
                                        Paste your schedule below. Format: Day Time Event (e.g., "Monday 9am Conditn Shift")
                                    </p>
                                </div>
                                <div className="modal-body">
                                    <textarea
                                        className="form-textarea"
                                        placeholder="Monday 9am Conditn Shift&#10;Tue 18:00 Hyrox training&#10;Wednesday 06:00 Strength workout"
                                        value={importText}
                                        onChange={(e) => setImportText(e.target.value)}
                                    />
                                </div>
                                <div className="modal-footer">
                                    <button className="btn btn-secondary" onClick={() => setShowImportModal(false)}>Cancel</button>
                                    <button className="btn btn-primary" onClick={handleTextImport}>Import</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Client Modal */}
                    {showAddClientModal && (
                        <div className="modal-overlay" onClick={() => setShowAddClientModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Add Client</h3>
                                    <p className="modal-description">
                                        Add a new client to your tracker
                                    </p>
                                </div>
                                <div className="modal-body">
                                    <div className="form-group">
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Client name"
                                            value={newClient.name}
                                            onChange={(e) => setNewClient({...newClient, name: e.target.value})}
                                        />
                                        <select
                                            className="form-select"
                                            value={newClient.week}
                                            onChange={(e) => setNewClient({...newClient, week: parseInt(e.target.value)})}
                                        >
                                            <option value="0">Starting Next Week</option>
                                            <option value="1">Week 1</option>
                                            <option value="2">Week 2</option>
                                            <option value="3">Week 3</option>
                                            <option value="4">Week 4</option>
                                            <option value="5">Weekly Client</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button className="btn btn-secondary" onClick={() => {
                                        setShowAddClientModal(false);
                                        setNewClient({ name: '', week: 0 });
                                    }}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={() => {
                                        if (!newClient.name) return;
                                        
                                        setClientData(prev => ({
                                            ...prev,
                                            clients: [...prev.clients, {
                                                id: Date.now(),
                                                name: newClient.name,
                                                week: newClient.week,
                                                startDate: new Date().toISOString().split('T')[0],
                                                status: 'active'
                                            }]
                                        }));
                                        
                                        setShowAddClientModal(false);
                                        setNewClient({ name: '', week: 0 });
                                    }}>
                                        Add Client
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Calendar Event Modal */}
                    {showCalendarEventModal && (
                        <div className="modal-overlay" onClick={() => setShowCalendarEventModal(false)}>
                            <div className="modal" onClick={e => e.stopPropagation()} style={{maxWidth: '600px'}}>
                                <div className="modal-header">
                                    <h3 className="modal-title">Add Event</h3>
                                </div>
                                <div className="modal-body">
                                    {/* Event Title */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Event Title</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Event title"
                                            value={newCalendarEvent.title}
                                            onChange={(e) => setNewCalendarEvent({...newCalendarEvent, title: e.target.value})}
                                        />
                                    </div>

                                    {/* Start Date */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Start Date</label>
                                        <input
                                            type="date"
                                            className="form-input"
                                            value={newCalendarEvent.startDate}
                                            onChange={(e) => setNewCalendarEvent({...newCalendarEvent, startDate: e.target.value})}
                                        />
                                    </div>

                                    {/* Add End Date Checkbox */}
                                    <div className="modal-section">
                                        <label className="checkbox-option">
                                            <input
                                                type="checkbox"
                                                checked={newCalendarEvent.hasEndDate}
                                                onChange={(e) => setNewCalendarEvent({...newCalendarEvent, hasEndDate: e.target.checked})}
                                            />
                                            <span>Add end date (multi-day event)</span>
                                        </label>
                                        {newCalendarEvent.hasEndDate && (
                                            <input
                                                type="date"
                                                className="form-input"
                                                style={{marginTop: '0.5rem'}}
                                                value={newCalendarEvent.endDate}
                                                onChange={(e) => setNewCalendarEvent({...newCalendarEvent, endDate: e.target.value})}
                                            />
                                        )}
                                    </div>

                                    {/* Add Start Time Checkbox */}
                                    <div className="modal-section">
                                        <label className="checkbox-option">
                                            <input
                                                type="checkbox"
                                                checked={newCalendarEvent.hasStartTime}
                                                onChange={(e) => setNewCalendarEvent({...newCalendarEvent, hasStartTime: e.target.checked})}
                                            />
                                            <span>Add start time</span>
                                        </label>
                                        {newCalendarEvent.hasStartTime && (
                                            <input
                                                type="time"
                                                className="form-input"
                                                style={{marginTop: '0.5rem'}}
                                                value={newCalendarEvent.startTime}
                                                onChange={(e) => setNewCalendarEvent({...newCalendarEvent, startTime: e.target.value})}
                                            />
                                        )}
                                    </div>

                                    {/* Location */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Location</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            placeholder="Location (optional)"
                                            value={newCalendarEvent.location}
                                            onChange={(e) => setNewCalendarEvent({...newCalendarEvent, location: e.target.value})}
                                        />
                                    </div>

                                    {/* Assign To */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Assign To</label>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                                            <div 
                                                className={`user-option ${newCalendarEvent.assignedTo.includes('macca') ? 'selected' : ''}`}
                                                onClick={() => toggleUserAssignment('macca')}
                                            >
                                                <div className="user-avatar macca">M</div>
                                                <span className="user-name">Macca</span>
                                            </div>
                                            <div 
                                                className={`user-option ${newCalendarEvent.assignedTo.includes('ruby') ? 'selected' : ''}`}
                                                onClick={() => toggleUserAssignment('ruby')}
                                            >
                                                <div className="user-avatar ruby">R</div>
                                                <span className="user-name">Ruby</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Show In */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Show In</label>
                                        <div className="show-in-options">
                                            <label className="checkbox-option">
                                                <input
                                                    type="checkbox"
                                                    checked={newCalendarEvent.showInDaily}
                                                    onChange={(e) => setNewCalendarEvent({...newCalendarEvent, showInDaily: e.target.checked})}
                                                />
                                                <span>Daily & Weekly</span>
                                            </label>
                                            <label className="checkbox-option">
                                                <input
                                                    type="checkbox"
                                                    checked={newCalendarEvent.showInMonthly}
                                                    onChange={(e) => setNewCalendarEvent({...newCalendarEvent, showInMonthly: e.target.checked})}
                                                />
                                                <span>Monthly & Yearly</span>
                                            </label>
                                        </div>
                                    </div>

                                    {/* Description */}
                                    <div className="modal-section">
                                        <label className="modal-section-title">Description</label>
                                        <textarea
                                            className="form-textarea"
                                            placeholder="Description (optional)"
                                            value={newCalendarEvent.description}
                                            onChange={(e) => setNewCalendarEvent({...newCalendarEvent, description: e.target.value})}
                                            style={{minHeight: '100px'}}
                                        />
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button className="btn btn-secondary" onClick={() => setShowCalendarEventModal(false)}>
                                        Cancel
                                    </button>
                                    <button className="btn btn-primary" onClick={handleAddCalendarEvent}>
                                        Add Event
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<DailyPlanner />, document.getElementById('root'));
    </script>
</body>
</html>
